<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>scope</title>
  </head>
  <body>
    <script>
      // scope is the current `context` of execution in which values and expressions
      // are 'visible' or can be referenced. for example, variables defined within
      // function are registered in the function scope in lexical environment, which
      // clean up by garbage collection when the function is done executing.

      // scope types:
      // 1. global scope
      // 2. function scope
      // 3. block scope
      // 4. module scope
      // 5. class scope
      // 6. lexical scope
      // 7. dynamic scope
      // 8. eval scope
      // 9. with scope
      // 10. closure scope
      // 11. this scope
      // 12. arrow function scope
      // 13. generator scope
      // 14. async function scope
      // 15. async generator scope
      // 16. globalThis scope
      // 17. private field scope
      // 18. private method scope
      // 19. private static field scope
      // 20. private static method scope

      // global scope: the default scope for all code running in script mode
      // module scope: scope for code running in module (file) modd
      // function scope: scope created waith a function

      // global scope and local scope
      {
        var x = 'global x'; // becomes a property of the global object

        function outer() {
          var y = 'outer y';

          function inner() {
            var z = 'inner x';

            console.log(z); // inner z
            console.log(y); // outer y
            console.log(x); // global x
          }
        }

        outer();

        try {
          console.log('global x', x);
          console.log('outer x', x); // ReferenceError: x is not defined
        } catch (e) {
          console.log(e);
        }

        // prevent global scope pollution
        (function () {
          var x1 = 'local x';
          console.log('local x', x);
        })();

        try {
          console.log(x1); // ReferenceError: x1 is not defined
        } catch (e) {
          console.log(e);
        }

        // avoid to use global variables, namespace
        var $ = {};
        $.id = 'id';
        console.log($.id);

        // using private variables
        var Counter = (function (init) {
          var count = init; // cannot be accessed from outside

          return {
            inc() {
              return count++;
            },
            dec() {
              return count--;
            },
          };
        })(3);

        console.log('count', Counter.count); // undefined
        console.log('count', Counter.inc()); // 4
        console.log('count', Counter.dec()); // 3

        // run by module scope
        // <script type="module" src="scope.js" />
      }

      // block scope: the scope created with a pair of curly braces(a block).
      {
        if (3 == '3') {
          // block scope for the if statement
        }

        for (var i = 0; i < 3; i++) {
          // block scope for the for statement
          console.log(i);
        }

        console.log(i); // 3, var is function scoped, not block scoped

        var a = 1; // global scope

        if (true) {
          // var only has function scope
          var a = 10;
        }

        console.log('a', a);

        function fn() {
          //
          console.log('a', a); // 10
        }

        fn();

        console.log('a', a); // 10

        try {
          // let and const are block scoped
          let b = 1; // global scope

          if (true) {
            // let and const are block scoped
            let b = 10;
          }

          console.log('global let b', b);

          for (let i2 = 0; i2 < 3; i2++) {
            // block scope for the for statement
            console.log('let i2', i2);
          }

          console.log(l2); // ReferenceError: l2 is not defined
        } catch (e) {
          console.log(e);
        }
      }

      // const, declare a block scope, read-only named constant
      {
        const c = 'c';

        if (true) {
          const c = 'c2';
          console.log(c); // c2
        }

        console.log(c); // c
      }

      // lexcial(static) scope: scope is defined by author-time
      // decisions of where functions are declared
      {
        var a = 'global a';

        function fn1() {
          var a = 'outer a';
          console.log(a); // outer a
          fn2();
        }

        function fn2() {
          // fn2 is decalred and defined in the global scope
          // fn2 is lexically scoped to the global scope, so it can access the global a
          console.log(a);
        }

        fn1(); // global a
        fn2(); // global a
      }
    </script>
  </body>
</html>
